#!/bin/sh

set -e

# setup environment
export PATH="/usr/share/rbenv/shims:$PATH"

# write some debug info
ruby -v
echo "hostname: $(hostname)"
echo "pwd: $(pwd)"
git --version
echo "node: $(node --version)"
echo "npm: $(npm --version)"

script/bootstrap

bundle exec rake test

find ./_site -type d \( -name assets -o -name _javascript -o -wholename _downloads/ar -o -wholename _downloads/bn_BD -o -wholename _downloads/de -o -wholename _downloads/es_ES -o -wholename _downloads/fr -o -wholename _downloads/it -o -wholename _downloads/ja -o -wholename _downloads/kr -o -wholename _downloads/pt_BR -o -wholename _downloads/pt_PT -o -wholename _downloads/sk -o -wholename _downloads/zh_CN \) -prune -o -name "*.html" -print >> ./script/list-of-files.txt

bundle exec npm test
