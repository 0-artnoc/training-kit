#!/bin/sh

set -e

# setup environment
export PATH="/usr/share/rbenv/shims:$PATH"

# write some debug info
ruby -v
echo "hostname: $(hostname)"
echo "pwd: $(pwd)"
git --version
echo "node: $(node --version)"
echo "npm: $(npm --version)"

script/bootstrap

bundle exec rake test

find ./_site -type d \( -path assets -o -path _javascript -o -path downloads \) -prune -o -name "*.html" -print >> ./script/list-of-files.txt
find ./_site/downloads -type d \( -path ar -o -path bn_BD -o -path de -o -path es_ES -o -path fr -o -path it -o -path ja -o -path kr -o -path pt_BR -o -path pt_PT -o -path sk -o -path zh_CN \) -prune -o -name "*.html" -print >> ./script/list-of-files.txt

bundle exec npm test
